<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BNI LINKED // MAP TACTIQUE</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <style>
        body { overflow: hidden; background: #05070a; }
        
        @media (min-width: 769px) {
            #top-bar { display: none !important; }
            #app-container { top: 0 !important; height: 100vh !important; }
            #sidebar-left { padding-top: 10px; }
        }

        .panel-section {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 15px;
            display: flex; flex-direction: column; gap: 10px;
        }
        
        .section-title {
            font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px;
            color: var(--text-muted); margin-bottom: 5px; display: block;
        }

        .file-btn { 
            font-size: 0.85rem; color: var(--text-muted); cursor: pointer; 
            border: 1px dashed var(--border-color); padding: 8px; 
            text-align: center; border-radius: 4px; transition: 0.2s;
            background: rgba(0,0,0,0.2); display: block; width: 100%;
        }
        .file-btn:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); background: rgba(115, 251, 247, 0.05); }

        .btn-row { display: flex; gap: 5px; }
        .btn-row > * { flex: 1; }

        .btn-switch {
            width: 100%; font-size: 0.8rem; padding: 8px;
            background: rgba(115, 251, 247, 0.1); border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan); text-transform: uppercase; letter-spacing: 1px;
            cursor: pointer; margin-top: 10px;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .btn-switch:hover { background: var(--accent-cyan); color: #000; }

        #app-loader {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: #05070a; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: #73fbf7; transition: opacity 0.5s ease;
        }
        .loader-text { 
            font-family: 'Rajdhani', sans-serif; font-size: 1.5rem; letter-spacing: 4px; 
            animation: pulse 1.5s infinite; text-transform: uppercase; 
        }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; text-shadow: 0 0 15px #73fbf7; } 100% { opacity: 0.5; } }
    </style>
</head>
<body>

    <div id="app-loader">
        <div class="loader-text">Initialisation Tactical Map...</div>
    </div>

    <div id="modal-overlay" class="hidden">
        <div id="modal-box">
            <div id="modal-title">TITRE</div>
            <div id="modal-content">Message...</div>
            <div id="modal-input-container" style="display:none;">
                <input type="text" id="modal-input" class="gps-input full-width" autocomplete="off">
            </div>
            <div id="modal-color-picker" style="display:none;">
                <div id="color-swatches" class="color-grid"></div>
                <div class="separator-h" style="margin: 10px 0;"></div>
                <label style="font-size:0.8rem; color:#8892b0;">Ou personnalis√© :</label>
                <div style="display:flex; align-items:center; gap:10px; margin-top:5px;">
                    <input type="color" id="modal-color-input" value="#ffffff" style="width:50px; height:40px; border:none; background:none;">
                    <span id="modal-color-hex" style="font-family:monospace; color:var(--text-main);">#FFFFFF</span>
                </div>
            </div>
            <div id="modal-actions"></div>
        </div>
    </div>

    <div id="context-menu" class="context-menu">
        <button id="ctx-new-point">üìç NOUVEAU POINT ICI</button>
        <button id="ctx-new-zone">‚≠ï NOUVELLE ZONE</button>
        <button id="ctx-new-free-zone" style="color:#73fbf7">‚úèÔ∏è DESSIN LIBRE</button>
        <div class="separator-h"></div>
        <button id="ctx-cancel" style="color:var(--text-dim)">‚ùå ANNULER</button>
    </div>

    <div id="top-bar">
        <div class="logo-area">
            <button id="btnMobileMenu" class="mobile-only">‚ò∞</button>
            <span class="app-logo">üí†</span>
            <span class="app-title">LINKED <span style="color:var(--accent-pink)">// MAP</span></span>
        </div>
    </div>

    <div id="app-container">
        
        <div id="sidebar-left">
            <div class="panel-section" style="text-align:center; align-items: center;">
                <img src="logo-bni-linked.png" alt="BNI LINKED" style="width:80%; max-height:80px; object-fit:contain; filter: drop-shadow(0 0 5px rgba(115,251,247,0.3));">
                
                <button class="btn-switch" onclick="window.location.href='../point/index.html';">
                    üï∏Ô∏è Mode R√©seau
                </button>
                
                <div id="cloud-status" style="font-size:0.8rem; color:var(--text-dim); margin-top:5px; display:none;">‚òÅÔ∏è Synchronis√©</div>
            </div>

            <div class="panel-section">
                <span class="section-title">DONN√âES</span>
                <input type="file" id="fileImport" accept=".json" style="display:none">
                <input type="file" id="fileMerge" accept=".json" style="display:none">

                <div class="btn-row">
                    <button id="btnCloudSave" class="mini-btn grow" style="justify-content:center;">‚òÅÔ∏è SAVE</button>
                    <button id="btnSave" class="mini-btn grow" style="justify-content:center;">üíæ JSON</button>
                </div>
                <div class="btn-row">
                    <button id="btnTriggerImport" class="file-btn">üìÇ Ouvrir</button>
                    <button id="btnTriggerMerge" class="file-btn">üß© Fusionner</button>
                </div>
            </div>

            <div class="panel-section" style="padding-bottom: 5px;">
                <span class="section-title">RECHERCHE</span>
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" placeholder="Nom, matricule..." autocomplete="off">
                </div>
            </div>

            <div class="panel-section">
                <button id="btnToggleGpsPanel" class="action-btn full-width">üì° SAISIE COORDONN√âES</button>
            </div>

            <div class="panel-header">
                <span>CALQUES OP√âRATIONNELS</span>
                <button id="btnAddGroup" class="mini-btn" title="Nouveau Groupe">Ôºã</button>
            </div>
            <div id="groups-list" class="scrollable-content"></div>
        </div>

        <div id="sidebar-overlay"></div>

        <div id="viewport">
            <div id="map-world">
                <img id="map-image" src="carte.jpg" alt="Carte Tactique">
                <svg style="position:absolute; width:0; height:0; overflow:hidden;">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ffffff" />
                        </marker>
                    </defs>
                </svg>
                <svg id="zones-layer"></svg>
                <svg id="links-layer" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none;"></svg>
            </div>
            <div id="markers-layer"></div>
            
            <div id="hud-bottom">
                <div id="coords-display" class="desktop-only">00.00 | 00.00</div>
                <div class="separator desktop-only"></div>
                
                <button id="btnToggleLight" class="hud-btn" title="Mode Lumi√®re / Hologramme">üí°</button>
                
                <button id="btnResetView" class="hud-btn" title="Recentrer">üéØ</button>
                
                <label class="hud-toggle" style="margin-left:10px;">
                    <input type="checkbox" id="chkLabels" checked> <span class="desktop-only">NOMS</span>
                </label>
            </div>

            <div id="gps-panel" class="floating-panel" style="display:none;">
                <div class="panel-header">
                    <span>POINT GPS</span>
                    <button class="mini-btn close-gps">√ó</button>
                </div>
                <div style="padding:15px;">
                    <div class="gps-row">
                        <input type="text" id="gpsInputX" placeholder="X" class="gps-input">
                        <input type="text" id="gpsInputY" placeholder="Y" class="gps-input">
                    </div>
                    <div style="margin-bottom:10px;">
                        <label style="font-size:0.7rem; color:var(--text-dim);">CALQUE CIBLE</label>
                        <select id="gpsGroupSelect" style="width:100%; background:rgba(0,0,0,0.3); color:white; border:1px solid #333; padding:5px;"></select>
                    </div>
                    <input type="text" id="gpsName" placeholder="Nom du point">
                    <div class="gps-row">
                        <div style="flex:1"><select id="gpsIconType"></select></div>
                        <div style="flex:1"><input type="text" id="gpsAffiliation" placeholder="Type"></div>
                    </div>
                    <textarea id="gpsNotes" placeholder="Notes..."></textarea>
                    <button id="btnAddGpsPoint" class="btn-primary full-width" style="margin-top:10px;">
                        üìç PLACER
                    </button>
                </div>
            </div>
        </div>

        <div id="sidebar-right">
            <div class="panel-header">DONN√âES CIBLE</div>
            <div id="editor-content">
                <div class="empty-state">S√©lectionnez un point</div>
            </div>
        </div>
    </div>

    <script type="module" src="./js/main.js"></script>
    <script type="module">
        import { state } from './js/state.js';
        window.state = state;
    </script>
    
    <script>
        window.addEventListener('load', () => {
          setTimeout(() => {
            const l = document.getElementById('app-loader');
            if(l) { l.style.opacity = '0'; setTimeout(() => l.remove(), 500); }
          }, 600);
        });

        // GESTION DU MODE LUMI√àRE
        const btnLight = document.getElementById('btnToggleLight');
        if(btnLight) {
            btnLight.addEventListener('click', () => {
                document.body.classList.toggle('high-light-mode');
                
                if(document.body.classList.contains('high-light-mode')) {
                    btnLight.classList.add('active'); // Allume le bouton
                } else {
                    btnLight.classList.remove('active');
                }
            });
        }
    </script>
</body>
</html>